const fs = require('fs');
const path = require('path');

// Target file
const tafseerPath = path.join('d:/Musafir/tazkirul-quran-en.json/tazkirul-quran-en.json');

// Common Islamic terms to look for (base list)
const commonTerms = {
    'allah': 'God',
    'rab': 'Lord',
    'rabb': 'Lord',
    'god': 'God',
    'quran': 'Quran',
    'koran': 'Quran',
    'book': 'Scripture',
    'kitab': 'Book',
    'hadith': 'Prophetic tradition',
    'hadeeth': 'Prophetic tradition',
    'sunnah': 'Prophetic way',
    'sunna': 'Prophetic way',
    'ayah': 'verse',
    'ayat': 'verses',
    'surah': 'chapter',
    'sura': 'chapter',
    'salah': 'prayer',
    'namaz': 'prayer',
    'salat': 'prayer',
    'fajr': 'dawn prayer',
    'zuhr': 'noon prayer',
    'dhuhr': 'noon prayer',
    'asr': 'afternoon prayer',
    'maghrib': 'sunset prayer',
    'isha': 'night prayer',
    'tahajjud': 'night prayer',
    'tarawih': 'night prayer in Ramadan',
    'witr': 'odd-numbered prayer',
    'janazah': 'funeral',
    'zakat': 'obligatory charity',
    'zakah': 'obligatory charity',
    'sadaqah': 'voluntary charity',
    'sadaqa': 'voluntary charity',
    'sawm': 'fasting',
    'siyam': 'fasting',
    'roza': 'fasting',
    'hajj': 'pilgrimage',
    'haj': 'pilgrimage',
    'umrah': 'minor pilgrimage',
    'jihad': 'struggle',
    'tawheed': 'monotheism',
    'tauheed': 'monotheism',
    'shirk': 'polytheism',
    'kufr': 'disbelief',
    'kufur': 'disbelief',
    'kafir': 'disbeliever',
    'kuffar': 'disbelievers',
    'iman': 'faith',
    'emaan': 'faith',
    'mumin': 'believer',
    'muslimeen': 'Muslims',
    'muslim': 'Muslim',
    'islam': 'Islam',
    'taqwa': 'God consciousness',
    'ihsan': 'excellence',
    'ikhlas': 'sincerity',
    'niyyah': 'intention',
    'tawbah': 'repentance',
    'istighfar': 'seeking forgiveness',
    'riba': 'interest',
    'sud': 'interest',
    'sood': 'interest',
    'haram': 'forbidden',
    'halal': 'permissible',
    'makruh': 'disliked',
    'mubah': 'permissible',
    'mustahabb': 'recommended',
    'bidah': 'innovation',
    'bidat': 'innovation',
    'jannah': 'Paradise',
    'jannat': 'Paradise',
    'garden': 'Paradise',
    'jahannam': 'Hell',
    'dozakh': 'Hell',
    'naar': 'Hellfire',
    'fire': 'Hellfire',
    'sabr': 'patience',
    'shukr': 'gratitude',
    'dua': 'supplication',
    'duaa': 'supplication',
    'dhikr': 'remembrance',
    'zikr': 'remembrance',
    'wudu': 'ablution',
    'wudhu': 'ablution',
    'ghusl': 'ritual bath',
    'tayammum': 'dry ablution',
    'qiblah': 'prayer direction',
    'qibla': 'prayer direction',
    'masjid': 'mosque',
    'mosque': 'mosque',
    'imam': 'leader',
    'sahaba': 'companions',
    'sahabah': 'companions',
    'rasul': 'Messenger',
    'messenger': 'Messenger',
    'nabi': 'Prophet',
    'prophet': 'Prophet',
    'deen': 'religion',
    'din': 'religion',
    'dunya': 'worldly life',
    'akhirah': 'Hereafter',
    'akhira': 'Hereafter',
    'fitnah': 'trial',
    'fitna': 'trial',
    'fasad': 'corruption',
    'ummah': 'community',
    'qisas': 'retaliation',
    'nikah': 'marriage',
    'talaq': 'divorce',
    'iddah': 'waiting period',
    'idda': 'waiting period',
    'hijab': 'veil',
    'purdah': 'veil',
    'zina': 'adultery',
    'fard': 'obligatory',
    'farz': 'obligatory',
    'wajib': 'necessary',
    'sunnat': 'Prophetic practice',
    'nafil': 'voluntary',
    'fatwa': 'religious ruling',
    'fiqh': 'jurisprudence',
    'sharia': 'Islamic law',
    'shariah': 'Islamic law',
    'zamzam': 'sacred water',
    'kaaba': 'Kaaba',
    'kabah': 'Kaaba',
    'iblis': 'Satan',
    'shaytan': 'Satan',
    'satan': 'Satan',
    'jinn': 'spirits',
    'jin': 'spirits',
    'malaika': 'angels',
    'angel': 'angel',
    'shahada': 'testimony of faith',
    'kalima': 'declaration of faith',
    'azhan': 'call to prayer',
    'adhan': 'call to prayer',
    'iqamah': 'call to commence prayer',
    'khutbah': 'sermon',
    'minbar': 'pulpit',
    'mihrab': 'niche',
    'rakat': 'unit of prayer',
    'rakaat': 'unit of prayer',
    'sujood': 'prostration',
    'sajda': 'prostration',
    'ruku': 'bowing',
    'tasbeeh': 'glorification',
    'aqiqah': 'birth sacrifice',
    'walima': 'marriage feast',
    'mahr': 'dowry',
    'haqq': 'truth',
    'batil': 'falsehood',
    'rahma': 'mercy',
    'barakah': 'blessing',
    'barakat': 'blessings',
    'rizq': 'sustenance',
    'ajal': 'appointed time',
    'qadar': 'destiny',
    'tawakkul': 'trust in God',
    'adl': 'justice',
    'zulm': 'oppression',
    'munafiq': 'hypocrite',
    'fasik': 'sinner',
    'alim': 'scholar',
    'ulama': 'scholars',
    'sheikh': 'elder',
    'hafiz': 'memorizer of Quran',
    'mufti': 'jurist',
    'caliph': 'successor',
    'khalifa': 'successor',
    'khilafah': 'caliphate',
    'amir': 'leader',
    'baiat': 'pledge of allegiance',
    'shura': 'consultation',
    'madrasa': 'school',
    'eid': 'festival',
    'ramadan': 'Ramadan',
    'ramazan': 'Ramadan',
    'shawwal': 'Shawwal',
    'muharram': 'Muharram',
    'ashura': '10th of Muharram',
    'safar': 'Safar',
    'rabi': 'Rabi',
    'awwal': 'First',
    'thani': 'Second',
    'jumada': 'Jumada',
    'rajab': 'Rajab',
    'shaban': 'Shaban',
    'dhul': 'Possessor of',
    'qada': 'Qa\'dah',
    'hijjah': 'Hijjah',
    'laylatul': 'Night of',
    'qadr': 'Power',
    'isra': 'Night Journey',
    'miraj': 'Ascension',
    'hijrah': 'Migration',
    'ansar': 'Helpers',
    'muhajirun': 'Emigrants',
    'ahlul': 'People of',
    'bayt': 'House',
    'injeel': 'Gospel',
    'tawrat': 'Torah',
    'zabur': 'Psalms',
    'qarnayn': 'Two Horns',
    'firaun': 'Pharaoh',
    'karoon': 'Korah',
    'haman': 'Haman',
    'yajeuj': 'Gog',
    'majeuj': 'Magog',
    'dajjal': 'Antichrist',
    'mahdi': 'Guided One',
    'isa': 'Jesus',
    'musa': 'Moses',
    'ibrahim': 'Abraham',
    'ismail': 'Ishmael',
    'ishaq': 'Isaac',
    'yusuf': 'Joseph',
    'yaqub': 'Jacob',
    'yunus': 'Jonah',
    'adam': 'Adam',
    'nuh': 'Noah',
    'lut': 'Lot',
    'hud': 'Hud',
    'saleh': 'Saleh',
    'shuaib': 'Shuaib',
    'idris': 'Enoch',
    'yahya': 'John',
    'zakariya': 'Zachariah',
    'maryam': 'Mary',
    'fatima': 'Fatima',
    'aisha': 'Aisha',
    'khadija': 'Khadija',
    'ali': 'Ali',
    'uthman': 'Uthman',
    'umar': 'Umar',
    'abubakr': 'Abu Bakr',
    'bilal': 'Bilal',
    'hamza': 'Hamza',
    'hassan': 'Hassan',
    'hussain': 'Hussain',
    'zainab': 'Zainab',
    'ruqayyah': 'Ruqayyah',
    'umml': 'Mother of',
    'banu': 'Children of',
    'israel': 'Israel',
    'bani': 'Children of',
    'ummi': 'unlettered',
    'jizya': 'tax',
    'kharaj': 'land tax',
    'waqf': 'endowment',
    'gharar': 'uncertainty',
    'maysir': 'gambling',
    'qimar': 'gambling',
    'takaful': 'insurance',
    'sukuk': 'bonds',
    'mashallah': 'God has willed it',
    'inshallah': 'if God wills',
    'subhanallah': 'Glory be to God',
    'alhamdulillah': 'Praise be to God',
    'allahuakbar': 'God is Greatest',
    'jazakallah': 'May God reward you',
    'bismillah': 'In the name of God',
    'salam': 'peace',
    'assalam': 'peace',
    'alaikum': 'upon you',
    'mud': 'measure',
    'saa': 'measure',
    'manna': 'manna',
    'salwa': 'quails',
    'toor': 'Mount',
    'sinai': 'Sinai',
    'arafat': 'Arafat',
    'mina': 'Mina',
    'muzdalifa': 'Muzdalifa',
    'safa': 'Safa',
    'marwa': 'Marwa',
    'hijr': 'Stone',
    'maqam': 'Station',
    'hateem': 'Hateem',
    'tawaf': 'circumambulation',
    'saee': 'walking',
    'ihram': 'state of ritual consecration',
    'talbiyah': 'Talbiyah',
    'jamarat': 'pillars',
    'hudaibiyah': 'Hudaibiyah',
    'badr': 'Badr',
    'uhud': 'Uhud',
    'khandaq': 'Trench',
    'hunayn': 'Hunayn',
    'tabuk': 'Tabuk',
    'khaybar': 'Khaybar',
    'muta': 'Muta',
    'taif': 'Taif',
    'yathrib': 'Yathrib',
    'medina': 'Madinah',
    'madinah': 'Madinah',
    'mecca': 'Makkah',
    'makkah': 'Makkah',
    'quds': 'Jerusalem',
    'aqsa': 'Aqsa',
    'dome': 'Dome',
    'rock': 'Rock',
    'cave': 'Cave',
    'hira': 'Hira',
    'thawr': 'Thawr',
    'jabal': 'Mount',
    'noor': 'Light',
    'rahmah': 'Mercy',
    'tur': 'Mount',
    'sidratul': 'Lote Tree',
    'muntaha': 'Utmost Boundary',
    'arsh': 'Throne',
    'kursi': 'Footstool',
    'lauh': 'Tablet',
    'mahfuz': 'Preserved',
    'qalam': 'Pen',
    'shafaat': 'intercession',
    'kawthar': 'Abundance',
    'salsabil': 'Salsabil',
    'tasnim': 'Tasnim',
    'kafur': 'Camphor',
    'zanjabil': 'Ginger',
    'sidr': 'Lote tree',
    'zakkum': 'Zaqqum',
    'ghishlin': 'pus',
    'hamim': 'boiling water',
    'ghassaq': 'purulent fluid',
    'sijjin': 'Sijjin',
    'illiyin': 'Illiyin',
    'malak': 'angel',
    'maut': 'death',
    'qabr': 'grave',
    'munkar': 'Munkar',
    'nakir': 'Nakir',
    'barzakh': 'barrier',
    'baas': 'resurrection',
    'hashr': 'gathering',
    'hisab': 'account',
    'mizan': 'balance',
    'sirat': 'path',
    'aaraf': 'heights',
    'haud': 'pool',
    'shafa': 'cure',
    'ruqya': 'healing incantation',
    'sihr': 'magic',
    'nazar': 'evil eye',
    'ain': 'eye',
    'hasad': 'envy',
    'ghiba': 'backbiting',
    'namima': 'calumny',
    'kibr': 'pride',
    'ujub': 'vanity',
    'riya': 'showing off',
    'nifaq': 'hypocrisy',
    'buhl': 'miserliness',
    'israf': 'extravagance',
    'tabdhir': 'squandering',
    'ghadab': 'anger',
    'hilm': 'forbearance',
    'haya': 'modesty',
    'saba': 'Sheba',
    'mubashshir': 'bearer of good news',
    'munzir': 'warner',
    'ma‘rifah': 'realization of God',
    'maarifah': 'realization of God',
    'marifah': 'realization of God',
    'sur': 'trumpet',
    'ilham': 'intuition',
    'wahi': 'revelation',
    'hikmah': 'wisdom',
    'hikmat': 'wisdom',
    'fasl': 'decisive',
    'tafsir': 'commentary',
    'tafseer': 'commentary',
    'da‘i': 'preacher',
    'dai': 'preacher',
    'daee': 'preacher',
    'bayyinah': 'clear proof',
    'ahwa': 'desires',
    'sakinah': 'tranquillity',
    'sakina': 'tranquillity',
    'fay': 'spoils of war',
    'ghanimah': 'war booty',
    'ita‘ah': 'obedience',
    'itaat': 'obedience',
    'alaq': 'clot',
    'usr': 'hardship',
    'yusr': 'ease',
    'tin': 'fig',
    'zaytoun': 'olive',
    'zaytun': 'olive',
    'sunni': 'Sunni',
    'shia': 'Shia',
    'sufi': 'Sufi',
    'kharijite': 'Kharijite',
    'baytullah': 'House of God',
    'sabiqun': 'foremost',
    'ashab': 'companions',
    'yamin': 'right',
    'shimal': 'left',
    'ghayb': 'unseen',
    'huda': 'guidance',
    'dalalah': 'error',
    'dalalat': 'error',
    // Surahs & Common Plurals
    'baqarah': 'Cow',
    'imran': 'Family of Imran',
    'nisa': 'Women',
    'maidah': 'Table Spread',
    'anam': 'Cattle',
    'anfal': 'Spoils of War',
    'tawbah': 'Repentance',
    'raad': 'Thunder',
    'nahl': 'Bee',
    'kahf': 'Cave',
    'maryam': 'Mary',
    'taha': 'Taha',
    'anbiya': 'Prophets',
    'muminun': 'Believers',
    'shuara': 'Poets',
    'naml': 'Ant',
    'qasas': 'Stories',
    'ankabut': 'Spider',
    'rum': 'Romans',
    'luqman': 'Luqman',
    'sajdah': 'Prostration',
    'ahzab': 'Confederates',
    'fatir': 'Originator',
    'yasin': 'Yasin',
    'saffat': 'Ranged in Rows',
    'sad': 'Sad',
    'zumar': 'Groups',
    'ghafir': 'Forgiver',
    'fussilat': 'Explained in Detail',
    'zukhruf': 'Gold Ornaments',
    'dukhan': 'Smoke',
    'jathiyah': 'Kneeling',
    'ahqaf': 'Dunes',
    'muhammad': 'Muhammad',
    'fath': 'Victory',
    'hujurat': 'Chambers',
    'qaf': 'Qaf',
    'dhariyat': 'Winnowing Winds',
    'najm': 'Star',
    'qamar': 'Moon',
    'rahman': 'Most Gracious',
    'waqiah': 'Inevitable Event',
    'hadid': 'Iron',
    'mujadila': 'Pleading Woman',
    'mumtahanah': 'Examined One',
    'saff': 'Ranks',
    'jumuah': 'Friday Congregation',
    'munafiqun': 'Hypocrites',
    'tahrim': 'Prohibition',
    'mulk': 'Dominion',
    'haqqah': 'Reality',
    'maarij': 'Ascending Stairways',
    'muzzammil': 'Enshrouded One',
    'muddathir': 'Cloaked One',
    'qiyamah': 'Resurrection',
    'insan': 'Human',
    'mursalat': 'Emissaries',
    'naba': 'Tidings',
    'naziat': 'Soul-snatchers',
    'abasa': 'He Frowned',
    'takwir': 'Overthrowing',
    'infitar': 'Cleaving',
    'mutaffifin': 'Defrauders',
    'inshiqaq': 'Sundering',
    'buruj': 'Constellations',
    'tariq': 'Morning Star',
    'ala': 'Most High',
    'ghashiyah': 'Overwhelming Event',
    'balad': 'City',
    'shams': 'Sun',
    'layl': 'Night',
    'duha': 'Morning Hours',
    'sharh': 'Solace',
    'zalzalah': 'Earthquake',
    'adiyat': 'Courser',
    'qariah': 'Calamity',
    'takathur': 'Piling Up',
    'humazah': 'Traducer',
    'fil': 'Elephant',
    'quraish': 'Quraish',
    'maun': 'Small Kindnesses',
    'kafirun': 'Disbelievers',
    'nasr': 'Help',
    'masad': 'Palm Fiber',
    'falaq': 'Daybreak',
    'nas': 'Mankind',
    'furqan': 'Criterion',
    'maqdis': 'Holy',
    'amr': 'Command',
    'hasanah': 'Good',
    'sayyiah': 'Evil',
    'maruf': 'Good',
    'mujahid': 'Struggler',
    'mujahideen': 'Strugglers',
    // Hadith & Specific Terms
    'rakah': 'unit of prayer',
    'rakat': 'units of prayer',
    'qital': 'fighting',
    'jalut': 'Goliath',
    'talut': 'Saul',
    'uzayr': 'Ezra',
    'tabut': 'Ark of the Covenant',
    'hanif': 'monotheist',
    'zakariyya': 'Zechariah',
    'muttaqun': 'righteous',
    'zalimun': 'wrongdoers',
    'fasiqun': 'rebellious',
    'jibril': 'Gabriel',
    'mikael': 'Michael',
    'mikail': 'Michael',
    'israfil': 'Raphael',
    'izrail': 'Azrael',
    'malikul': 'Angel of',
    'mawt': 'Death',
    'dajjal': 'Antichrist',
    'mahdi': 'Guided One',
    'yajuj': 'Gog',
    'majuj': 'Magog',
    'salsabil': 'Salsabil (Spring in Paradise)',
    'tasnim': 'Tasnim (Spring in Paradise)',
    'kauthar': 'Abundance',
    'kawthar': 'Abundance',
    'sidratul': 'Lote Tree',
    'muntaha': 'Utmost Boundary',
    'zamzam': 'Zamzam'
};

function analyzeTafseer() {
    if (!fs.existsSync(tafseerPath)) {
        console.error('Tafseer file not found at:', tafseerPath);
        return;
    }

    const data = JSON.parse(fs.readFileSync(tafseerPath, 'utf8'));
    let fullText = "";

    // Aggregate text
    for (const key in data) {
        if (data[key].text) {
            fullText += data[key].text + " ";
        }
    }

    // Identify parenthesized terms: "word (definition)" or "definition (word)"
    const parenthesizedRegex = /([a-zA-Z']+(?:\s[a-zA-Z']+)?)\s*\(([^)]+)\)/g;
    const matches = [];
    let match;

    // We are looking for things like "zakat (alms)" or "alms (zakat)"
    while ((match = parenthesizedRegex.exec(fullText)) !== null) {
        const part1 = match[1].toLowerCase().trim();
        const part2 = match[2].toLowerCase().trim();

        // Simple heuristic: if one part is in our known arabic list, the other is the definition
        if (commonTerms[part1]) {
            // Found standard term in text, check if definition matches
            // console.log(`Found usage: ${part1} (${part2})`);
        } else if (commonTerms[part2]) {
            // console.log(`Found usage: ${part2} (${part1})`);
        } else {
            // Potential new term?
            // console.log(`Potential pair: ${part1} <-> ${part2}`);
            matches.push({ term: part1, def: part2 });
        }
    }

    const termMap = { ...commonTerms };

    // Add logic here if we wanted to auto-discover, but for now we'll stick to the robust list 
    // and maybe output stats on which ones are actually found in the text.

    console.log(`Loaded ${Object.keys(termMap).length} base terms.`);

    // Verify which terms appear in the text to prioritize them
    const foundTerms = new Set();
    const lowerText = fullText.toLowerCase();

    for (const term of Object.keys(termMap)) {
        if (lowerText.includes(term)) {
            foundTerms.add(term);
        }
    }

    console.log(`Found ${foundTerms.size} of them in the Tafseer text.`);
    console.log('Generating map file...');

    fs.writeFileSync(path.join(__dirname, 'islamic-terms-map.json'), JSON.stringify(termMap, null, 2));
    console.log('Done.');
}

analyzeTafseer();
